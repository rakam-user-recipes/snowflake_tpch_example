version: 2
sources:
- name: tpch
  database: SNOWFLAKE_SAMPLE_DATA
  schema: TPCH_SF1   
  tables:    
  - name: orders 
    identifier: ORDERS   
    meta: 
      rakam: 
        mappings: 
          userId: o_custkey
          eventTimestamp: o_orderdate   
        measures:
          total_orders:
            aggregation: count 
            type: double
          total_users:
            aggregation: approximate_unique
            dimension: o_custkey
        aggregates:
          totals_by_date:
            measures: ['total_orders', 'total_users']
            dimensions: ['o_orderdate', 'o_orderstatus', 'o_orderpriority']
    columns:
    - name: O_ORDERKEY
      meta:
        rakam.dimension:
          type: double
          name: o_orderkey
        rakam.measure:
          aggregation: sum
          type: double
    - name: O_CUSTKEY
      meta:
        rakam.dimension:
          type: double
          name: o_custkey
        rakam.measure:
          aggregation: sum
          type: double
      tests: 
        - relationships:
            to: source('tpch', 'customer')
            field: c_custkey 
            rakam:
              relation: one_to_many 
              join: left_join

    - name: O_ORDERSTATUS
      meta:
        rakam.dimension:
          type: string
          name: o_orderstatus
    - name: O_TOTALPRICE
      meta:
        rakam.dimension:
          type: double
          name: o_totalprice
          format: $0,0
        rakam.measure:
          aggregation: sum
          type: double
    - name: O_ORDERDATE
      meta:
        rakam.dimension:
          type: date
          name: o_orderdate
    - name: O_ORDERPRIORITY
      meta:
        rakam.dimension:
          type: string
          name: o_orderpriority
    - name: O_CLERK
      meta:
        rakam.dimension:
          type: string
          name: o_clerk
    - name: O_SHIPPRIORITY
      meta:
        rakam.dimension:
          type: double
          name: o_shippriority
        rakam.measure:
          aggregation: sum
          type: double
    - name: O_COMMENT
      meta:
        rakam.dimension:
          type: string
          name: o_comment
